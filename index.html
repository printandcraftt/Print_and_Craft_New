<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Print & Craft üíú</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:'Poppins',sans-serif;
transition:.3s;
}

body{
background:#f5f0ff;
color:#333;
}

/* NAV */
nav{
background:white;
padding:15px 20px;
display:flex;
justify-content:space-between;
align-items:center;
position:sticky;
top:0;
z-index:1000;
box-shadow:0 5px 15px rgba(0,0,0,0.05);
}

.logo{
font-weight:800;
font-size:18px;
color:#6a00f4;
}

nav ul{
list-style:none;
display:flex;
gap:20px;
align-items:center;
}

nav a{
text-decoration:none;
color:#6a00f4;
font-weight:600;
font-size:14px;
}

#darkToggle{
background:#6a00f4;
color:white;
border:none;
padding:6px 14px;
border-radius:20px;
cursor:pointer;
}

/* HERO */
.hero{
background:linear-gradient(135deg,#6a00f4,#9d4edd);
color:white;
text-align:center;
padding:80px 20px;
}

/* PRODUCTS */
.products{
padding:60px 20px;
text-align:center;
}

.products h2{
color:#6a00f4;
margin-bottom:40px;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
gap:20px;
}

.product{
background:white;
border-radius:15px;
overflow:hidden;
box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

.product img{
width:100%;
height:200px;
object-fit:cover;
}

.product h3{
margin-top:10px;
color:#6a00f4;
}

.product p{
font-size:13px;
padding:0 15px 15px;
color:#555;
}

.view-btn{
background:#6a00f4;
color:white;
padding:14px 30px;
border-radius:30px;
text-decoration:none;
display:inline-block;
margin-top:40px;
}

/* REVIEWS */
.reviews-section{
padding:60px 20px;
text-align:center;
background:#fff;
}

.review-card{
background:#f5f0ff;
padding:20px;
border-radius:15px;
margin-bottom:20px;
}

.stars{
display:flex;
justify-content:center;
gap:8px;
}

.stars span{
font-size:22px;
cursor:pointer;
opacity:0.4;
}

.stars span.active{
opacity:1;
}

footer{
background:#6a00f4;
color:white;
text-align:center;
padding:30px;
margin-top:60px;
}

/* DARK MODE */
body.dark{
background:#121212;
color:#f1f1f1;
}
body.dark nav,
body.dark footer{
background:#1e1e1e;
}
body.dark .product,
body.dark .review-card{
background:#1f1f1f;
}

/* PROMO POPUP */
.promo-popup{
position:fixed;
inset:0;
background:rgba(0,0,0,.6);
display:none;
justify-content:center;
align-items:center;
z-index:9999;
}

.promo-box{
background:white;
padding:30px;
border-radius:20px;
text-align:center;
width:320px;
position:relative;
}

.close-btn{
position:absolute;
top:10px;
right:15px;
font-size:22px;
cursor:pointer;
color:#6a00f4;
}

.wheel{
width:220px;
height:220px;
border-radius:50%;
margin:20px auto;
border:6px solid #6a00f4;
background:conic-gradient(
#6a00f4 0% 25%,
#bb86fc 25% 50%,
#9d4edd 50% 75%,
#e0aaff 75% 100%
);
transition:transform 4s ease-out;
}
</style>
</head>
<body>
<!-- NAVIGATION -->
<nav>
  <div class="logo">Print & Craft üíú</div>
  <ul>
    <li><a href="products.html">Products</a></li>
    <li><a href="reviews.html">All Reviews</a></li>
    <li><a href="admin.html">Admin</a></li>
    <li><button id="darkToggle">üåô</button></li>
  </ul>
</nav>

<!-- HERO -->
<section class="hero">
  <h1>Handmade Gifts That Speak Love üíú</h1>
  <p>Create unforgettable memories with our custom crafts made with heart and passion.</p>
</section>

<!-- PRODUCTS -->
<section class="products">
  <h2>Our Products ‚ú®</h2>

  <div class="grid">

    <div class="product">
      <img src="images/bouquet/Bouquet.jpg">
      <h3>Fuzzywire Bouquet</h3>
      <p>Handmade fuzzy wire flower bouquet perfect for birthdays and surprises.</p>
    </div>

    <div class="product">
      <img src="images/polaroid/Polaroid.jpg">
      <h3>Polaroid Prints</h3>
      <p>High-quality polaroid prints to capture your best memories.</p>
    </div>

    <div class="product">
      <img src="images/box set/Box set.jpg">
      <h3>Polaroid Box Set</h3>
      <p>Complete 45-piece custom polaroid collection inside a premium gift box.</p>
    </div>

    <div class="product">
      <img src="images/bracelet/Bracelet.jpg">
      <h3>Bracelet</h3>
      <p>Customized beaded bracelets for couples, friends, and loved ones.</p>
    </div>

    <div class="product">
      <img src="images/keychain/Keychain.jpg">
      <h3>Keychain</h3>
      <p>Personalized keychains to carry your favorite photo everywhere.</p>
    </div>

    <div class="product">
      <img src="images/frame/Frame.jpg">
      <h3>Photo Frame</h3>
      <p>Spotify-style music photo frame gift idea for special occasions.</p>
    </div>

    <div class="product">
      <img src="images/Photostrips/PhotoStrips.jpg">
      <h3>Photostrips</h3>
      <p>Mini photo booth strips perfect for cute and fun memories.</p>
    </div>

  </div>

  <a href="products.html" class="view-btn">View All Products üíú</a>
</section>

<!-- REVIEWS SECTION -->
<section class="reviews-section">
  <h2>Customer Feedback üíú</h2>

  <div style="font-size:20px;font-weight:600;color:#6a00f4;margin-bottom:20px;">
    <span id="averageRating">0.0</span> ‚≠ê
    <p>Average Rating</p>
  </div>

  <div id="reviewsContainer"></div>

  <a href="reviews.html" class="view-btn" style="margin-bottom:30px;">
    View All Reviews üíú
  </a>

  <h3 style="margin-top:40px;">Leave a Review ‚ú®</h3>

  <form id="reviewForm" style="max-width:400px;margin:0 auto;display:flex;flex-direction:column;gap:15px;">
    <input type="text" id="name" placeholder="Your Name" required style="padding:12px;border-radius:10px;border:1px solid #ddd;">

    <div class="stars">
      <span data-value="1">‚≠ê</span>
      <span data-value="2">‚≠ê</span>
      <span data-value="3">‚≠ê</span>
      <span data-value="4">‚≠ê</span>
      <span data-value="5">‚≠ê</span>
    </div>

    <textarea id="reviewText" placeholder="Write your review..." required style="padding:12px;border-radius:10px;border:1px solid #ddd;"></textarea>

    <button type="submit" style="padding:12px;border:none;border-radius:25px;background:#6a00f4;color:white;font-weight:600;">
      Submit Review üíú
    </button>
  </form>
</section>
  
<script type="module">

/* ================= FIREBASE IMPORTS ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  getDocs, 
  query, 
  orderBy 
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* ================= YOUR FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyCCMd6565SLeJx0zCM5h8bkj5UzSBZeQcA",
  authDomain: "print-craft-9d708.firebaseapp.com",
  projectId: "print-craft-9d708",
  storageBucket: "print-craft-9d708.firebasestorage.app",
  messagingSenderId: "873230926106",
  appId: "1:873230926106:web:464e08d3ce7d111b6aeca3"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* Make db global (promo + admin use) */
window.db = db;

/* ================= DARK MODE ================= */

const toggle = document.getElementById("darkToggle");

if(localStorage.getItem("darkMode") === "enabled"){
  document.body.classList.add("dark");
}

toggle.addEventListener("click",()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem(
    "darkMode",
    document.body.classList.contains("dark") ? "enabled" : "disabled"
  );
});

/* ================= REVIEW SYSTEM ================= */

let selectedRating = 0;
const stars = document.querySelectorAll(".stars span");

/* Select stars */
stars.forEach(star=>{
  star.addEventListener("click",()=>{
    selectedRating = star.dataset.value;

    stars.forEach(s=>s.classList.remove("active"));

    for(let i=0;i<selectedRating;i++){
      stars[i].classList.add("active");
    }
  });
});

/* Mask name like Li**** */
function maskName(name){
  if(name.length <= 2) return name;
  return name.substring(0,2) + "****";
}

/* Load ONLY 3 latest reviews */
async function loadReviews(){

  const container = document.getElementById("reviewsContainer");
  container.innerHTML = "";

  let total = 0;
  let count = 0;

  const q = query(
    collection(db,"reviews"),
    orderBy("createdAt","desc")
  );

  const snapshot = await getDocs(q);

  const docs = snapshot.docs.slice(0,3); // ONLY 3

  docs.forEach(doc=>{
    const review = doc.data();

    total += review.rating;
    count++;

    container.innerHTML += `
      <div style="background:#f5f0ff;padding:20px;border-radius:15px;margin-bottom:20px;">
        <h4 style="color:#6a00f4;">${maskName(review.name)}</h4>
        <p>${"‚≠ê".repeat(review.rating)}</p>
        <p>${review.text}</p>
      </div>
    `;
  });

  if(count > 0){
    document.getElementById("averageRating").innerText =
      (total / count).toFixed(1);
  }
}

loadReviews();

/* Submit review */
document.getElementById("reviewForm")
.addEventListener("submit", async function(e){

  e.preventDefault();

  if(selectedRating == 0){
    alert("Please select rating ‚≠ê");
    return;
  }

  await addDoc(collection(db,"reviews"),{
    name: document.getElementById("name").value,
    rating: parseInt(selectedRating),
    text: document.getElementById("reviewText").value,
    createdAt: new Date()
  });

  document.getElementById("reviewForm").reset();
  stars.forEach(s=>s.classList.remove("active"));
  selectedRating = 0;

  loadReviews();
});

</script>
<!-- ================= PROMO POPUP ================= -->

<div class="promo-popup" id="promoPopup">
  <div class="promo-box">
    <span class="close-btn" onclick="closePromo()">‚úñ</span>
    <h3>Spin & Win Discount üéÅ</h3>

    <div class="wheel" id="wheel"></div>

    <button id="spinBtn">SPIN NOW üé°</button>

    <p id="promoResult" style="margin-top:15px;font-weight:600;"></p>
  </div>
</div>

<!-- ================= CONFETTI CANVAS ================= -->
<canvas id="confettiCanvas"
style="position:fixed;inset:0;pointer-events:none;z-index:9998;"></canvas>

<script type="module">

/* ================= PROMO SYSTEM ================= */

import { collection, addDoc } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const wheel = document.getElementById("wheel");
const spinBtn = document.getElementById("spinBtn");
const resultText = document.getElementById("promoResult");
const popup = document.getElementById("promoPopup");

let spinning = false;

/* 1 TRY PER DAY */
const today = new Date().toDateString();
if(localStorage.getItem("promoDate") === today){
  spinBtn.disabled = true;
  resultText.innerText = "You already tried today üíú";
}

/* Close popup */
window.closePromo = function(){
  popup.style.display = "none";
};

/* Spin Logic */
spinBtn.addEventListener("click", async ()=>{

  if(spinning) return;
  spinning = true;

  const random = Math.random();
  let discount = null;

  /* 50% WIN CHANCE */
  if(random < 0.25){
    discount = "10% OFF";
  }else if(random < 0.5){
    discount = "20% OFF";
  }

  const rotation = 3600 + Math.floor(Math.random()*360);
  wheel.style.transform = `rotate(${rotation}deg)`;

  setTimeout(async ()=>{

    if(discount){

      const code = "PC" + Math.floor(10000 + Math.random()*90000);

      resultText.innerHTML = `
        üéâ YOU WON ${discount}!<br>
        Code: <b>${code}</b><br>
        Screenshot & Message Us üíú
      `;

      launchConfetti();
      launchFireworks();

      /* SAVE WINNER TO FIREBASE */
      await addDoc(collection(window.db,"winners"),{
        code: code,
        discount: discount,
        createdAt: new Date()
      });

    }else{
      resultText.innerText = "Try Again Tomorrow üíî";
    }

    localStorage.setItem("promoDate", today);
    spinBtn.disabled = true;
    spinning = false;

  },4000);

});

/* ================= CONFETTI ================= */

function launchConfetti(){
  const canvas = document.getElementById("confettiCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let pieces = [];

  for(let i=0;i<150;i++){
    pieces.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height - canvas.height,
      size: Math.random()*8+4,
      speed: Math.random()*3+2
    });
  }

  function update(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p=>{
      p.y += p.speed;
      ctx.fillStyle = "#bb86fc";
      ctx.fillRect(p.x,p.y,p.size,p.size);
    });
    requestAnimationFrame(update);
  }

  update();

  setTimeout(()=>{
    ctx.clearRect(0,0,canvas.width,canvas.height);
  },3000);
}

/* ================= FIREWORKS ================= */

function launchFireworks(){
  const canvas = document.getElementById("confettiCanvas");
  const ctx = canvas.getContext("2d");

  for(let i=0;i<20;i++){
    setTimeout(()=>{
      ctx.beginPath();
      ctx.arc(
        Math.random()*canvas.width,
        Math.random()*canvas.height/2,
        5,0,Math.PI*2
      );
      ctx.fillStyle="#9d4edd";
      ctx.fill();
    }, i*150);
  }
}

</script>

</body>
</html>
